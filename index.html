<!DOCTYPE- html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="soccerW.png">
<link rel="icon" href="soccerW.png" type="image/png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes"> 
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ì „ë¬¸ê°€ìš© ì¶•êµ¬ ì‘ì „íŒ PRO</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root { --red-color: #e74c3c; --blue-color: #3498db; --bg-color: #f4f7f6; --toggle-btn-color: #2c3e50; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body { 
      margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; 

      background-color: var(--bg-color); 
      background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), 
                    url('ful.png'); 
/* ------------- ë°±ê·¸ë¼ìš´ë“œ ì´ë¯¸ì§€ ------------------ */
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      font-family: 'Pretendard', sans-serif; 
      overflow-x: hidden; width: 100%; touch-action: pan-y;
    }
    
    #toggleMenuBtn { background: var(--toggle-btn-color); color: white; border: none; padding: 8px 0; width: 180px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; margin: 10px auto 0px auto; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 2000; position: relative; }

    #field { 
width: 100%; 
max-width: calc(95vh * 1.414); /* ì„¸ë¡œ ë†’ì´ ê¸°ì¤€ìœ¼ë¡œ ê°€ë¡œê°€ ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ ë°©ì§€ */
aspect-ratio: 1.414 / 1; 
max-height: 85vh;
/* ------------- ì¶•êµ¬ì¥ í•„ë“œ ì´ë¯¸ì§€ ------------------ */
background-color: #27ae60; 
background-size: 100% 100%; 
border: 4px solid #fff; 
position: relative; z-index: 1; 
overflow: hidden; 
}
    
    #field-container { 
position: relative; 
width: 100%; 
display: flex;
justify-content: center;
align-items: center;
padding: 5px; /* í™”ë©´ ëì— ë„ˆë¬´ ë¶™ì§€ ì•Šê²Œ ì‚´ì§ ì—¬ìœ  */
touch-action: none; 
 }

/* ë°°ê²½ ì´ë¯¸ì§€ ë ˆì´ì–´ */
#field-bg {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  background-size: 100% 100%;
  z-index: 1; /* ê°€ì¥ ì•„ë˜ */
}

/* ë¼ì¸ ì´ë¯¸ì§€ ë ˆì´ì–´ (íˆ¬ëª… PNG ê¶Œì¥) */
#field-lines {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  background-image: url("filed.png");
  background-size: 100% 100%;
  pointer-events: none; /* ë¼ì¸ì´ ë§ˆìš°ìŠ¤ í´ë¦­ì„ ë°©í•´í•˜ì§€ ì•Šë„ë¡ ì„¤ì • */
  z-index: 2; /* ë°°ê²½ë³´ë‹¤ ìœ„ */
}


    #menuOverlay { position: absolute; top: 0; left: 0; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 1000; pointer-events: none; }
    
    /* ê°€ë¡œ 1ì—´ ìœ ì§€ ë° ìë™ í­ ì¡°ì ˆ */
    #bottomControls { 
      pointer-events: auto; width: 95%; max-width: 1200px; 
      background: rgba(255, 255, 255, 0.98); 
      border-radius: 15px; padding: 10px; 
      display: flex; flex-direction: row; /* ê°€ë¡œ ì •ë ¬ */
      justify-content: center; gap: 4px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.4); 
      backdrop-filter: blur(10px); transition: opacity 0.3s ease;
      z-index: 1001; margin-top: 10px; touch-action: auto;
      overflow-x: auto; /* ë„ˆë¬´ ì¢ìœ¼ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
    }
    #bottomControls.collapsed { display: none; }


    /* í…ìŠ¤íŠ¸ ì„ ëª…ë„ (ê·¸ë¦¼ì ì œê±°) */
    .draggable { 
      border-radius: 50%; display: flex; align-items: center; justify-content: center; 
      position: absolute; cursor: grab; font-weight: bold; z-index: 10 !important; 
      background-size: cover; background-position: center; 
      text-shadow: none !important; /* ê·¸ë¦¼ì ì ˆëŒ€ ê¸ˆì§€ */
      pointer-events: auto; transform: translate(-50%, -50%); 
      touch-action: none; transition: left 0.4s ease-out, top 0.4s ease-out;
    }

    .player { border: 4px solid #000; box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
    .player[data-team="red"] { border-color: var(--red-color); }
    .player[data-team="blue"] { border-color: var(--blue-color); }
    
    .ball { 
width: 45px; 
height: 45px; 
background-image: url("Wball.png"); 
background-size: cover;
z-index: 10; 
border: 2px solid #333; 
}
/* ------------- ì¶•êµ¬ê³µ ì´ë¯¸ì§€ ------------------ */

    .card { 
background: white; 
padding: 5px 4px; 
border-radius: 8px; 
border: 1px solid #ddd; 
flex: 1; 
min-width: 120px; /* ì¹´ë“œì˜ ìµœì†Œ ë„ˆë¹„ í™•ë³´ */
display: flex; 
flex-direction: column; 
overflow: hidden; 
    }

    .card-header { 
display: flex; 
justify-content: space-between; 
align-items: center; 
margin-bottom: 8px; 
border-bottom: 2px solid #eee; 
padding-bottom: 5px; 
}
    .card-header h3, .card h3 {
  font-size: 11px !important; 
  margin: 2px 0 !important;
}

    .formation-select { 
  font-size: 10px;
  padding: 2px;
  max-width: 65px;
}

    .input-row { display: flex; width: 100%; gap: 3px; margin-bottom: 8px; align-items: center; }
    input[type="text"] { flex: 1; min-width: 0; height: 30px; padding: 0 5px; border: 1.5px solid #ccc; border-radius: 6px; font-size: 12px; outline: none; }
    
input[type="text"], .btn-add, .color-toggle, .file-btn-box {
  height: 24px !important; 
  font-size: 10px !important;
}

    .color-toggle { display: flex; border: 1px solid #ccc; border-radius: 6px; overflow: hidden; height: 30px; flex-shrink: 0; }
    .color-toggle input { display: none; }
    .color-toggle label { width: 25px; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; background: #eee; color: #999; }
    .color-toggle input:checked + label { background: #333; color: #fff; }
    .color-toggle input:checked + label.label-white { background: #fff; color: #000; border: 1px solid #333; }

    .btn-add { height: 30px; padding: 0 8px; font-size: 12px; border-radius: 6px; border: none; color: white; cursor: pointer; font-weight: bold; flex-shrink: 0; }
    .file-btn-box { height: 30px; border: 1.5px solid #ccc; border-radius: 6px; margin-bottom: 8px; background: #f8f9fa; cursor: pointer; display: flex; align-items: center; width: 100%; padding: 0 5px; overflow: hidden; }
    .setting-grid { 
display: grid; 
grid-template-columns: 40px 1fr !important;; 
column-gap: 3px; 
align-items: center; 
font-size: 10px; 
width: 100% !important; 
margin-bottom: 3px; 
overflow: hidden; /* ì‚ì ¸ë‚˜ê° ë°©ì§€ */
}
    
    .data-btn-container { display: flex; flex-direction: column; gap: 5px; margin-top: auto; }
.btn-full {
  padding: 4px 2px !important;
  font-size: 10px !important;
  border-radius: 4px;
}

    .list-item { 
display: flex; 
justify-content: space-between; 
padding: 4px 0; 
border-bottom: 1px dashed #eee; 
font-size: 11px; 
align-items: center; 
gap: 3px; 
}
    .btn-small { padding: 3px 5px; font-size: 10px; border: 1px solid #ddd; background: #fff; border-radius: 3px; cursor: pointer; }

@media screen and (max-width: 600px) {
      #bottomControls {
        padding: 5px;
        gap: 2px;
}

/* ê²Œì´ì§€(ìŠ¬ë¼ì´ë”) ìì²´ê°€ ë¶€ëª¨ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šê²Œ ì„¤ì • */
input[type="range"] {
    width: 100% !important; /* ë¶€ëª¨ ë„ˆë¹„ ì•ˆì—ì„œë§Œ ì‘ë™ */
    height: 12px;
    margin: 0 !important;
    cursor: pointer;
  }
      }

  </style>
</head>
<body>

  <button id="toggleMenuBtn" onclick="toggleMenu()">â–¼ ì„¤ ì • â–¼</button>

  <div id="field-container">
    <div id="field">
      <div id="field-bg"></div>
      <div id="field-lines"></div>
      <div class="ball draggable" id="ball" style="left:50%; top:50%;"></div>
    </div>

    <div id="menuOverlay">
      <div id="bottomControls" class="collapsed">
        <div class="card">
          <div class="card-header"><h3 style="color:var(--red-color); margin:0; font-size:14px;">RED</h3>
            <select class="formation-select" onchange="applyFormation('red', this.value)">
              <option value="">í¬ë©”ì´ì…˜</option><option value="4-4-2">4-4-2</option><option value="4-3-3">4-3-3</option><option value="3-5-2">3-5-2</option>
            </select>
          </div>
          <div class="input-row">
            <input type="text" id="redInput" placeholder="ì„ ìˆ˜ëª…" onkeypress="if(event.key==='Enter')addPlayer('red')">
            <div class="color-toggle">
              <input type="radio" name="redColor" id="redW" value="white" checked onchange="changeTeamNameColor('red', 'white')"><label for="redW" class="label-white">W</label>
              <input type="radio" name="redColor" id="redB" value="black" onchange="changeTeamNameColor('red', 'black')"><label for="redB">B</label>
            </div>
            <button class="btn-add" style="background:var(--red-color);" onclick="addPlayer('red')">ì¶”ê°€</button>
          </div>
          <label class="file-btn-box">
            <div class="setting-grid"><span>ìœ ë‹ˆí¼</span><div style="font-size:9px; color:#999; overflow:hidden; white-space:nowrap;" id="redFileName">ì§€ì • ì•ˆë¨</div></div>
            <input type="file" accept="image/*" style="display:none;" onchange="handleImageUpload(event, 'red')">
          </label>
          <div class="setting-grid"><span>ì„ ìˆ˜í¬ê¸°</span><input type="range" id="redPlayerSize" min="30" max="100" value="55" oninput="updateTeamStyle('red')"></div>
          <div class="setting-grid"><span>ê¸€ìí¬ê¸°</span><input type="range" id="redFontSize" min="10" max="24" value="12" oninput="updateTeamStyle('red')"></div>
          <div id="redList" style="max-height:200px; overflow-y:auto; margin-top:5px;"></div>
        </div>

        <div class="card">
          <div class="card-header"><h3 style="color:var(--blue-color); margin:0; font-size:14px;">BLUE</h3>
            <select class="formation-select" onchange="applyFormation('blue', this.value)">
              <option value="">í¬ë©”ì´ì…˜</option><option value="4-4-2">4-4-2</option><option value="4-3-3">4-3-3</option><option value="3-5-2">3-5-2</option>
            </select>
          </div>
          <div class="input-row">
            <input type="text" id="blueInput" placeholder="ì„ ìˆ˜ëª…" onkeypress="if(event.key==='Enter')addPlayer('blue')">
            <div class="color-toggle">
              <input type="radio" name="blueColor" id="blueW" value="white" checked onchange="changeTeamNameColor('blue', 'white')"><label for="blueW" class="label-white">W</label>
              <input type="radio" name="blueColor" id="blueB" value="black" onchange="changeTeamNameColor('blue', 'black')"><label for="blueB">B</label>
            </div>
            <button class="btn-add" style="background:var(--blue-color);" onclick="addPlayer('blue')">ì¶”ê°€</button>
          </div>
          <label class="file-btn-box">
            <div class="setting-grid"><span>ìœ ë‹ˆí¼</span><div style="font-size:9px; color:#999; overflow:hidden; white-space:nowrap;" id="blueFileName">ì§€ì • ì•ˆë¨</div></div>
            <input type="file" accept="image/*" style="display:none;" onchange="handleImageUpload(event, 'blue')">
          </label>
          <div class="setting-grid"><span>ì„ ìˆ˜í¬ê¸°</span><input type="range" id="bluePlayerSize" min="30" max="100" value="55" oninput="updateTeamStyle('blue')"></div>
          <div class="setting-grid"><span>ê¸€ìí¬ê¸°</span><input type="range" id="blueFontSize" min="10" max="24" value="12" oninput="updateTeamStyle('blue')"></div>
          <div id="blueList" style="max-height:200px; overflow-y:auto; margin-top:5px;"></div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0; font-size:14px; color:#555;">FIELD & DATA</h3>
          <div class="setting-grid" style="margin-bottom:8px;">
     <span>íˆ¬ëª…ë„</span>
     <input type="range" min="10" max="100" value="98" oninput="updateMenuOpacity(this.value)"></div>
          <div class="setting-grid" style="margin-bottom:8px;">
    <span>ê³µí¬ê¸°</span>
    <input type="range" id="ballSize" min="20" max="100" value="45" oninput="updateBallSize(this.value)"></div>

<label class="file-btn-box">
    <div class="setting-grid">
        <span>ì¶•êµ¬ê³µ</span>
        <div style="font-size:9px; color:#999; overflow:hidden; white-space:nowrap;" id="ballFileName">ì§€ì • ì•ˆë¨</div>
    </div>
    <input type="file" accept="image/*" style="display:none;" onchange="handleImageUpload(event, 'ball')">
</label>

          <label class="file-btn-box">
            <div class="setting-grid"><span>ê²½ê¸°ì¥</span><div style="font-size:9px; color:#999; overflow:hidden; white-space:nowrap;" id="fieldNameDisplay">ì§€ì • ì•ˆë¨</div></div>
            <input type="file" id="fieldInput" style="display:none;" onchange="handleImageUpload(event, 'field')">
          </label>
          <div class="data-btn-container" style="margin-top: 5px !important;">
            <button class="btn-full" style="background:#f39c12;" onclick="takeScreenshot()">ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·</button>
            <button class="btn-full" style="background:#2c3e50;" onclick="saveData()">ğŸ’¾ ì € ì¥</button>
            <button class="btn-full" style="background:#27ae60;" onclick="document.getElementById('fileLoader').click()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn-full" style="background:#e74c3c;" onclick="resetAll()">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
          </div>
          <input type="file" id="fileLoader" accept=".json" style="display:none;" onchange="loadData(event)">
        </div>
      </div>
    </div>
  </div>

  <script>
    const field = document.getElementById('field'), ball = document.getElementById('ball'), bottomControls = document.getElementById('bottomControls');
    let currentFileName = "soccerW_filed_data.json";
    const persistentImages = { red: null, blue: null, field: null, ball: null };
    const activeDrags = new Map();

    function makeDraggable(el) {
      const onStart = (e) => {
        if (e.target.closest('#bottomControls')) return;
        const touches = e.changedTouches || [e];
        for (const t of touches) {
          const id = t.identifier !== undefined ? t.identifier : 'mouse';
          const rect = el.getBoundingClientRect();
          activeDrags.set(id, { target: el, offsetX: t.clientX - (rect.left + rect.width / 2), offsetY: t.clientY - (rect.top + rect.height / 2) });
          el.style.transition = "none";
          el.style.zIndex = 1000;
        }
      };
      const onMove = (e) => {
        const touches = e.changedTouches || [e];
        for (const t of touches) {
          const id = t.identifier !== undefined ? t.identifier : 'mouse';
          const d = activeDrags.get(id);
          if (d && d.target === el) {
            const fr = field.getBoundingClientRect();
            let x = ((t.clientX - fr.left - d.offsetX) / fr.width) * 100;
            let y = ((t.clientY - fr.top - d.offsetY) / fr.height) * 100;
            el.style.left = Math.max(0, Math.min(100, x)) + "%";
            el.style.top = Math.max(0, Math.min(100, y)) + "%";
          }
        }
        if (activeDrags.size > 0 && e.cancelable) e.preventDefault();
      };
      const onEnd = (e) => {
        const touches = e.changedTouches || [e];
        for (const t of touches) { activeDrags.delete(t.identifier !== undefined ? t.identifier : 'mouse'); }
        el.style.zIndex = 5;
        setTimeout(() => { el.style.transition = "left 0.4s ease-out, top 0.4s ease-out"; }, 10);
      };
      el.addEventListener('mousedown', onStart);
      window.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onEnd);
      el.addEventListener('touchstart', onStart, { passive: false });
      window.addEventListener('touchmove', onMove, { passive: false });
      window.addEventListener('touchend', onEnd);
    }

    // ì‹¤ì‹œê°„ íŒ€ ì´ë¦„ ìƒ‰ìƒ ë³€ê²½
    function changeTeamNameColor(team, color) {
      document.querySelectorAll(`.player[data-team="${team}"]`).forEach(p => p.style.color = color);
    }

    function addPlayer(t, n=null, x="50%", y="50%", c=null) {
      const input = document.getElementById(t+'Input'), name = n || input.value.trim();
      if(!name) return;
      const chosenColor = c || document.querySelector(`input[name="${t}Color"]:checked`).value;
      const p = document.createElement('div');
      p.className='player draggable'; p.innerText=name; p.style.left=x; p.style.top=y; p.dataset.team=t;
      p.style.color = chosenColor;
      if(persistentImages[t]) { p.style.backgroundImage=`url(${persistentImages[t]})`; p.style.backgroundColor = 'transparent'; }
      else { p.style.backgroundColor = 'rgba(0,0,0,0.3)'; }
      const s = document.getElementById(t+'PlayerSize').value, f = document.getElementById(t+'FontSize').value;
      p.style.width=s+'px'; p.style.height=s+'px'; p.style.fontSize=f+'px';
      makeDraggable(p); field.appendChild(p);
      const list = document.getElementById(t+'List'), item = document.createElement('div');
      item.className = 'list-item'; item.playerEl = p;
      item.innerHTML = `<span style="flex:1; font-weight:bold; overflow:hidden;">${name}</span><div style="display:flex; gap:3px;"><button class="btn-small" onclick="moveOrder(this, 'up')">â–²</button><button class="btn-small" onclick="moveOrder(this, 'down')">â–¼</button><button class="btn-small" onclick="editPlayer(this)">ìˆ˜ì •</button><button class="btn-small" style="color:red;" onclick="removePlayer(this)">ì‚­ì œ</button></div>`;
      list.appendChild(item); if(!n) input.value="";
    }

    function saveData() {
      const fn = prompt("íŒŒì¼ëª… ì…ë ¥:", currentFileName.replace(".json", ""));
      if (!fn) return;
      currentFileName = fn + ".json";
      const players = Array.from(document.querySelectorAll('.player')).map(p => ({
        name: p.innerText, team: p.dataset.team, x: p.style.left, y: p.style.top, color: p.style.color
      }));
      const config = { players, ball: { x: ball.style.left, y: ball.style.top, size: ball.style.width || "45px" }, images: persistentImages };
      const a = document.createElement("a");
      a.href = URL.createObjectURL(new Blob([JSON.stringify(config)], {type: "application/json"}));
      a.download = currentFileName; a.click();
    }

// ì™¸ë¶€ ì£¼ì†Œ ì´ë¯¸ì§€ë¥¼ ë³´ì•ˆ í—ˆìš©í•˜ë©° ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ (ì„¤ëª…ì„œ)
function setExternalImage(target, url) {
  if (!url) return;
  const img = new Image();
  img.crossOrigin = "Anonymous"; // ë³´ì•ˆ í—ˆìš© ìš”ì²­ì˜ í•µì‹¬!
  img.src = url;
  img.onload = function() {
    if(target === 'field') {
      field.style.backgroundImage = `url('${url}')`;
    } else {
      document.querySelectorAll(`.player[data-team="${target}"]`).forEach(p => {
        p.style.backgroundImage = `url('${url}')`;
        p.style.backgroundColor = 'transparent';
      });
    }
  };
}

    function loadData(event) {
      const file = event.target.files[0]; if (!file || !confirm("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        const d = JSON.parse(e.target.result);

        document.querySelectorAll('.player, .list-item').forEach(el => el.remove());
// 2. [ì¶”ê°€] í•„ë“œ ë°°ê²½ ì´ˆê¸°í™” (íŒŒì¼ì— ë°°ê²½ì´ ì—†ë”ë¼ë„ ê¸°ë³¸ìœ¼ë¡œ ë˜ëŒë¦¼)
    const defaultField = 'https://postfiles.pstatic.net/MjAyNjAxMjlfMjI1/MDAxNzY5NjM1Mjc0NjQ5.502_CqNalGrTYu6ZLubeKv3k_Yi01fCGmv4_tRIq_a4g.BvhqNdBmteUb3ZSa07vyILSugnFty_RPVM18IN9cxYAg.PNG/field.png?type=w580';
    field.style.backgroundImage = `url('${defaultField}')`;
    document.getElementById('fieldNameDisplay').innerText = "ì§€ì • ì•ˆë¨";
    persistentImages.field = null; // ë©”ëª¨ë¦¬ìƒì˜ ë°°ê²½ ë°ì´í„°ë„ ì´ˆê¸°í™”

        if (d.images) { 
          Object.assign(persistentImages, d.images); 

// loadData í•¨ìˆ˜ ë‚´ë¶€ì˜ d.images.field ì²˜ë¦¬ ë¶€ë¶„
if (d.images.field) {
  persistentImages.field = d.images.field; // ë©”ëª¨ë¦¬ì— ì €ì¥
  const bgLayer = document.getElementById('field-bg');
  if(bgLayer) {
    bgLayer.style.backgroundImage = `url(${d.images.field})`;
  }
  document.getElementById('fieldNameDisplay').innerText = "ë¶ˆëŸ¬ì˜¨ ë°°ê²½";
}

      if (d.images.red) setExternalImage('red', d.images.red);
      if (d.images.blue) setExternalImage('blue', d.images.blue);
 
if (d.images.ball) {
        ball.style.backgroundImage = `url('${d.images.ball}')`;
        ball.style.backgroundColor = 'transparent';
        ball.style.backgroundSize = 'cover';
        if(document.getElementById('ballFileName')) {
            document.getElementById('ballFileName').innerText = "ì €ì¥ëœ ê³µ";
        }
      }
    }  

        if(d.players) d.players.forEach(p => addPlayer(p.team, p.name, p.x, p.y, p.color));
        if (d.ball) { ball.style.left = d.ball.x; ball.style.top = d.ball.y; if(d.ball.size) {
    ball.style.width = d.ball.size;
    ball.style.height = d.ball.size;
const ballSlider = document.getElementById('ballSize');
    if (ballSlider) {
ballSlider.value = parseInt(d.ball.size); // d.ball.sizeì—ì„œ ìˆ«ìë¥¼ ì§ì ‘ ì¶”ì¶œ
    }
  }
}
      };
      reader.readAsText(file);
      event.target.value = '';
    }

 function takeScreenshot() {
  const wasCollapsed = bottomControls.classList.contains('collapsed');
  if (!wasCollapsed) toggleMenu(); // ë©”ë‰´ ìˆ¨ê¸°ê¸°

  // 0.5ì´ˆ ëŒ€ê¸° (ë©”ë‰´ê°€ ì™„ì „íˆ ì‚¬ë¼ì§„ í›„ ìº¡ì²˜)
  setTimeout(() => {
    const target = document.querySelector("#field");
    
    html2canvas(target, {
      useCORS: true,           // ì™¸ë¶€ ì´ë¯¸ì§€ í—ˆìš©
      allowTaint: true,       // ë³´ì•ˆ ì •ì±… ì¤€ìˆ˜
      scale: 2,                // ê³ í™”ì§ˆ (2ë°°)
      backgroundColor: "#27ae60", // ë°°ê²½ì´ ë¹„ì–´ìˆì„ ë•Œ ê¸°ë³¸ ì´ˆë¡ìƒ‰ ì ìš©
      logging: true,
      width: target.offsetWidth,
      height: target.offsetHeight
    }).then(canvas => {
      try {
        const link = document.createElement('a');
        const now = new Date();
        const dateStr = now.toISOString().slice(0, 10).replace(/-/g, "");
        const timeStr = String(now.getHours()).padStart(2, '0') + String(now.getMinutes()).padStart(2, '0');
        
        // íŒŒì¼ í˜•ì‹ì„ pngë¡œ ë³€ê²½ (ë¼ì¸ íˆ¬ëª…ë„ ìœ ì§€ì— ìœ ë¦¬)
        link.download = `${dateStr}_${timeStr}_soccerW.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (e) {
        console.error("ìº¡ì²˜ ì—ëŸ¬:", e);
        alert("ë¸Œë¼ìš°ì € ë³´ì•ˆ ì„¤ì •ìœ¼ë¡œ ì¸í•´ ìŠ¤í¬ë¦°ìƒ·ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ì—…ë¡œë“œí•œ ìƒíƒœì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
      }
      
      if (!wasCollapsed) toggleMenu(); // ë‹¤ì‹œ ë©”ë‰´ í‘œì‹œ
    });
  }, 500);
}


 async function handleImageUpload(e, t) {
  const f = e.target.files[0]; if(!f) return;
  const b = await new Promise(r=>{
    const rd=new FileReader(); 
    rd.readAsDataURL(f); 
    rd.onload=()=>r(rd.result);
  });
  
  persistentImages[t] = b;
  
// handleImageUpload í•¨ìˆ˜ ë‚´ë¶€ ìˆ˜ì •
if(t === 'field') { 
    document.getElementById('field-bg').style.backgroundImage = `url(${b})`; 
    document.getElementById('fieldNameDisplay').innerText = "ë°°ê²½:" + f.name; 
}
else if(t==='ball') {
    ball.style.backgroundImage = `url(${b})`;
    ball.style.backgroundColor = 'transparent'; // ê¸°ë³¸ íšŒìƒ‰ ì œê±°
    ball.style.backgroundSize = 'cover';
    ball.style.backgroundPosition = 'center';
    document.getElementById('ballFileName').innerText = "ê³µ:" + f.name;
  }
else { 
    document.querySelectorAll(`.player[data-team="${t}"]`).forEach(p=>{ 
      p.style.backgroundImage=`url(${b})`; 
      p.style.backgroundColor = 'transparent'; 
      // ì•„ë˜ ë‘ ì¤„ì„ ì¶”ê°€í•˜ë©´ ìŠ¤í¬ë¦°ìƒ· ì„±ê³µ í™•ë¥ ì´ ì˜¬ë¼ê°‘ë‹ˆë‹¤.
      p.style.backgroundSize = 'cover';
      p.style.backgroundPosition = 'center';
    }); 
    document.getElementById(t+'FileName').innerText = f.name; 
  }
}
    function updateTeamStyle(t){
      const s=document.getElementById(t+'PlayerSize').value, f=document.getElementById(t+'FontSize').value;
      document.querySelectorAll(`.player[data-team="${t}"]`).forEach(p=>{p.style.width=s+'px';p.style.height=s+'px';p.style.fontSize=f+'px';});
    }
function updateBallSize(v) {
  const ball = document.getElementById('ball');
  ball.style.width = v + 'px';
  ball.style.height = v + 'px';
}
    function applyFormation(t, f) {
      const ps = Array.from(document.getElementById(t+'List').children).map(it => it.playerEl), forms = {'4-4-2':[[10,50],[20,20],[20,40],[20,60],[20,80],[32,20],[32,40],[32,60],[32,80],[44,35],[44,65]],'4-3-3':[[10,50],[20,20],[20,40],[20,60],[20,80],[32,30],[32,50],[32,70],[44,20],[44,50],[44,80]],'3-5-2':[[10,50],[20,25],[20,50],[20,75],[32,15],[32,32],[32,50],[32,68],[32,85],[44,35],[44,65]]};
      const pos = forms[f]; if(!pos) return;
      ps.forEach((p, i)=>{ if(pos[i]){ let x=t==='blue'?100-pos[i][0]:pos[i][0]; p.style.left=x+"%"; p.style.top=pos[i][1]+"%"; }});
    }
    function toggleMenu() { const col = bottomControls.classList.toggle('collapsed'); document.getElementById('toggleMenuBtn').innerText = col ? "â–¼ ì„¤ ì • â–¼" : "â–² ì„¤ ì • â–²"; }
    function updateMenuOpacity(v) { bottomControls.style.opacity = v / 100; }
    function resetAll() { if(confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) location.reload(); }
    function moveOrder(btn, dir) {
      const it = btn.closest('.list-item'), target = dir === 'up' ? it.previousElementSibling : it.nextElementSibling;
      if(!target) return;
      const p1 = it.playerEl, p2 = target.playerEl;
      const tx = p1.style.left, ty = p1.style.top;
      p1.style.left = p2.style.left; p1.style.top = p2.style.top;
      p2.style.left = tx; p2.style.top = ty;
      if(dir==='up') it.parentNode.insertBefore(it, target); else it.parentNode.insertBefore(target, it);
    }
function removePlayer(btn) { 
  const it = btn.closest('.list-item'); 
  if (it.playerEl) it.playerEl.remove(); // í•„ë“œ ìœ„ ì„ ìˆ˜ ì œê±°
  it.remove(); // ë¦¬ìŠ¤íŠ¸ ëª©ë¡ ì œê±°
}
    function editPlayer(btn) {
      const it = btn.closest('.list-item'), span = it.querySelector('span'), newName = prompt("ìˆ˜ì •:", span.innerText);
      if(newName) { span.innerText = newName; it.playerEl.innerText = newName; }
    }

// í•„ë“œ í¬ê¸°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°ì ˆí•˜ëŠ” í•¨ìˆ˜
    function adjustZoom(val) {
      const container = document.getElementById('field-container');
      const zoomText = document.getElementById('zoomVal');
      
      // ì»¨í…Œì´ë„ˆ ë„ˆë¹„ë¥¼ ìŠ¬ë¼ì´ë” ê°’ì— ë”°ë¼ ë³€ê²½ (ìµœì†Œ 200pxê¹Œì§€ ì‘ì•„ì§)
      container.style.width = val + 'px';
      
      // í˜„ì¬ í¬ê¸°ë¥¼ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
      if(zoomText) zoomText.innerText = val + 'px';
    }

    makeDraggable(ball);

    // ë‘ ì†ê°€ë½ í™•ëŒ€(Pinch Zoom) ë°©ì§€
document.addEventListener('touchstart', function (e) {
  if (e.touches.length > 1) {
    e.preventDefault();
  }
}, { passive: false });

// ë”ë¸” íƒ­ í™•ëŒ€ ë°©ì§€
let lastTouchEnd = 0;
document.addEventListener('touchend', function (e) {
  const now = (new Date()).getTime();
  if (now - lastTouchEnd <= 300) {
    e.preventDefault();
  }
  lastTouchEnd = now;
}, false);
    
  </script>
</body>

</html>



